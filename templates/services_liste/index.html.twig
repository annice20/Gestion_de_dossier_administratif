{% extends 'base.html.twig' %}

{% block title %}Liste des Services{% endblock %}

{% block body %}
<style>
    .container3{
        display: flex;
        gap: 4rem;
        margin: 0 auto;
        top: 0;
        justify-content: center;
        padding: 1rem;
    }
    .header3{
        text-align: center;
        margin-bottom: 1rem;
    }
    .table {
        height: 25rem;
    }
    .demande-header2 {
        text-align: center;
        margin-bottom: 1rem;
    }
    .card{
        
    }
    .card-body{
        padding: 0;
        margin: 0;
    }
    .btn{
        width: 100%;
        margin-top: 1rem;
    }
    
    /* Styles pour les modaux */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 800px;
        max-height: 80vh;
        overflow-y: auto;
    }
    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }
    .close:hover {
        color: black;
    }
    .service-row {
        cursor: pointer;
        transition: background-color 0.3s;
    }
    .service-row:hover {
        background-color: #f8f9fa;
    }
</style>

<div class="container3">
    <div class="service-table">
        <div class="header3">
            <h1>LISTE DES SERVICES</h1>
        </div>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Lequel</th>
                    <th>Pièces requises</th>
                    <th>Délais</th>
                </tr>
            </thead>
            <tbody>
                <tr class="service-row" onclick="openModal('naissance')">
                    <td class="text-primary">Acte de naissance</td>
                    <td>
                        <div class="piece-item">• Livre de famille</div>
                        <div class="piece-item">• Résidence</div>
                    </td>
                    <td>2 heures</td>
                </tr>
                <tr class="service-row" onclick="openModal('mariage')">
                    <td class="text-primary">Acte de mariage</td>
                    <td>
                        <div class="piece-item">• Acte de naissance</div>
                        <div class="piece-item">• Résidence</div>
                        <div class="piece-item">• Acte de célibataire</div>
                    </td>
                    <td>Le jour du mariage</td>
                </tr>
                <tr class="service-row" onclick="openModal('deces')">
                    <td class="text-primary">Acte de décès</td>
                    <td>
                        <div class="piece-item">• Certificat de décès</div>
                        <div class="piece-item">• Pièce d'identité du commandeur</div>
                        <div class="piece-item">• Montantes sur le déficient</div>
                        <div class="piece-item">• Livret de famille</div>
                    </td>
                    <td>24 heures</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="demande-sectionn">
        <div class="demande-header2">
            <h1>DEMANDE</h1>
        </div>

        <div class="demande-form">
            {% for message in app.flashes('success') %}
                <div class="alert alert-success">
                    {{ message }}
                </div>
            {% endfor %}

            <div class="card">
                <div class="card-body">
                    {{ form_start(form) }}
                        <div class="col-md-12">
                            {{ form_row(form.ref) }}
                        </div>
                        <div class="col-md-12">
                            {{ form_row(form.demandeur) }}
                        </div>
                        <div class="col-md-12">
                            {{ form_row(form.type) }}
                        </div>
                        <div class="col-md-12">
                            {{ form_row(form.centre) }}
                        </div>
                        <div class="col-md-12">
                            {{ form_row(form.priorite) }}
                        </div>
                        <div class="col-md-12">
                            {{ form_row(form.canal) }}
                        </div>
                        <div class="col-md-12">
                            {{ form_row(form.montant) }}
                        </div>
                        
                        <!-- Champs cachés pour stocker les données des formulaires modaux -->
                        <input type="hidden" id="form_naissance_data" name="form_naissance_data">
                        <input type="hidden" id="form_mariage_data" name="form_mariage_data">
                        <input type="hidden" id="form_deces_data" name="form_deces_data">
                        
                        <div class="mt-3">
                            <button type="submit" class="btn btn-primary">Créer la demande</button>
                            <a href="{{ path('services_liste_index') }}" class="btn btn-secondary">Annuler</a>
                        </div>
                    {{ form_end(form) }}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modaux pour les formulaires spécifiques -->
<div id="modalNaissance" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('naissance')">&times;</span>
        <h2>Formulaire Acte de Naissance</h2>
        {{ render(controller('App\\Controller\\ActeNaissanceController::formulaire')) }}
        <button onclick="saveFormData('naissance')" class="btn btn-success">Enregistrer</button>
    </div>
</div>

<div id="modalMariage" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('mariage')">&times;</span>
        <h2>Formulaire Acte de Mariage</h2>
        {{ render(controller('App\\Controller\\ActeMariageController::formulaire')) }}
        <button onclick="saveFormData('mariage')" class="btn btn-success">Enregistrer</button>
    </div>
</div>

<div id="modalDeces" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('deces')">&times;</span>
        <h2>Formulaire Acte de Décès</h2>
        {{ render(controller('App\\Controller\\ActeDecesController::formulaire')) }}
        <button onclick="saveFormData('deces')" class="btn btn-success">Enregistrer</button>
    </div>
</div>

<script>
    function openModal(type) {
        document.getElementById('modal' + type.charAt(0).toUpperCase() + type.slice(1)).style.display = 'block';
        // Met à jour le champ type du formulaire principal
        document.getElementById('{{ form.type.vars.id }}').value = type;
    }

    function closeModal(type) {
        document.getElementById('modal' + type.charAt(0).toUpperCase() + type.slice(1)).style.display = 'none';
    }

    function saveFormData(type) {
        // Récupère les données du formulaire modal
        const formData = new FormData(document.getElementById('form-' + type));
        const data = {};
        for (let [key, value] of formData.entries()) {
            data[key] = value;
        }
        
        // Stocke les données dans le champ caché correspondant
        document.getElementById('form_' + type + '_data').value = JSON.stringify(data);
        
        // Ferme le modal
        closeModal(type);
        
        alert('Données ' + type + ' enregistrées avec succès !');
    }

    // Fermer le modal en cliquant en dehors
    window.onclick = function(event) {
        if (event.target.classList.contains('modal')) {
            event.target.style.display = 'none';
        }
    }

    // Gestion du changement de type dans le select
    document.getElementById('{{ form.type.vars.id }}').addEventListener('change', function() {
        const selectedType = this.value;
        if (selectedType && selectedType !== '') {
            openModal(selectedType);
        }
    });
</script>
{% endblock %}